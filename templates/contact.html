{% extends 'base.html' %}

{% block title %}Contact Page{% endblock %}

{% block content %}
    <div class="text-center">
        <h1>Contact Page</h1>
    </div>
    <div class="container">
        <div class="row d-flex justify-content-center">
            <div class="col-sm-6 col-12">
                <form class="contact-form" method="post" action="{% url 'contact_url' %}">{% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-success">Send</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block bottom %}
    <script>
        $(document).ready(function () {
          let contactForm = $('.contact-form');
          let contactFormMethod = contactForm.attr('method');
          let contactFormEndPoint = contactForm.attr('action');
          let contactFormSubmitBtn = contactForm.find("[type='submit']");
          let contactFormSubmitBtnTxt = contactFormSubmitBtn.text();
          function displaySubmitting(doSubmit) {
            if (doSubmit) {
                contactFormSubmitBtn.attr('disabled', 'true');
                contactFormSubmitBtn.html("<i class='fa fa-spin fa-spinner'></i>Sending...");
            } else {
                contactFormSubmitBtn.removeAttr('disabled');
                contactFormSubmitBtn.html(contactFormSubmitBtnTxt);
            }
          }
          contactForm.submit(function (event) {
             event.preventDefault();
             let contactFormData = contactForm.serialize();
             let thisForm = $(this);
             displaySubmitting(true);
             $.ajax({
                 method: contactFormMethod,
                 url: contactFormEndPoint,
                 data: contactFormData,
                 success: function (data) {
                     thisForm[0].reset();
                      $.alert({
                         title: 'Success !',
                         content: data.message,
                         theme: 'modern',
                     });
                      setTimeout(function () {
                       displaySubmitting(false);
                      }, 2000);
                 },
                 error: function (error) {
                     displaySubmitting(false);
                     let jsonError = error.responseJSON;
                     let msg = '';
                     $.each(jsonError, function (key, value) {
                        msg += key.charAt(0).toUpperCase() + key.slice(1) + ": " + value[0].message + "<br/>";
                     });
                     $.alert({
                         title: 'Oops !',
                         content: msg,
                         theme: 'modern',
                     });
                 }
             });
          });
        });
    </script>
{% endblock %}